#!/usr/bin/env zsh

cleandesk() {
	# Date-stamped folder name
	local folder_name=$(date +"%Y%m%d")

	# Target folder in iCloud Documents
	local target_folder="$HOME/Documents/@@Ordenar/$folder_name/"

	# Create the target folder
	mkdir -p "$target_folder"

	# Move contents, creating subfolders only when there is something to move
	if [ -n "$(ls -1 "$HOME/Desktop" 2>/dev/null)" ]; then
		mkdir -p "$target_folder/Desktop"
		mv "$HOME/Desktop"/* "$target_folder/Desktop"
	fi
	if [ -n "$(ls -1 "$HOME/Downloads" 2>/dev/null)" ]; then
		mkdir -p "$target_folder/Downloads"
		mv "$HOME/Downloads"/* "$target_folder/Downloads"
	fi
	local icloud_downloads_path="$HOME/Library/Mobile Documents/com~apple~CloudDocs/Downloads"
	if [ -d "$icloud_downloads_path" ] && [ -n "$(ls -1 "$icloud_downloads_path" 2>/dev/null)" ]; then
		mkdir -p "$target_folder/iCloud-Downloads"
		mv "$icloud_downloads_path"/* "$target_folder/iCloud-Downloads"
	fi

	cd "$target_folder"

	open "$target_folder"
}
